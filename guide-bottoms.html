<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>1.4&nbsp;Partial Functions and Nontermination</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="other-reference.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">The Hackett Programming Language</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="guide.html" class="tocviewselflink" data-pltdoc="x">The Hackett Guide</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="reference.html" class="tocviewlink" data-pltdoc="x">The Hackett Reference</a></td></tr><tr><td align="right"></td><td><a href="doc-index.html" class="tocviewlink" data-pltdoc="x">Index</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9660;</a></td><td>1&nbsp;</td><td><a href="guide.html" class="tocviewlink" data-pltdoc="x">The Hackett Guide</a></td></tr></table><div class="tocviewsublistbottom" style="display: block;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">1.1&nbsp;</td><td><a href="guide-quick-start.html" class="tocviewlink" data-pltdoc="x">Quick Start</a></td></tr><tr><td align="right">1.2&nbsp;</td><td><a href="guide-hackett-essentials.html" class="tocviewlink" data-pltdoc="x">Hackett Essentials</a></td></tr><tr><td align="right">1.3&nbsp;</td><td><a href="guide-working-with-data.html" class="tocviewlink" data-pltdoc="x">Working with data</a></td></tr><tr><td align="right">1.4&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Partial Functions and Nontermination</a></td></tr></table></div></div></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="guide-working-with-data.html" title="backward to &quot;1.3 Working with data&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="guide.html" title="up to &quot;1 The Hackett Guide&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="reference.html" title="forward to &quot;2 The Hackett Reference&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h4>1.4<tt>&nbsp;</tt><a name="(part._guide-bottoms)"></a>Partial Functions and Nontermination</h4><p>In Hackett, functions are generally expected to be <a name="(tech._total._function)"></a><span style="font-style: italic">total</span>, which
means they should produce a result for all possible inputs. For example, <span class="RktSym"><a href="reference-datatypes.html#%28def._%28%28lib._hackett%2Fmain..rkt%29._not%29%29" class="RktValLink" data-pltdoc="x">not</a></span> is obviously
defined for both <span class="RktSym"><a href="reference-datatypes.html#%28def._%28%28lib._hackett%2Fmain..rkt%29._.True%29%29" class="RktValLink" data-pltdoc="x">True</a></span> and <span class="RktSym"><a href="reference-datatypes.html#%28def._%28%28lib._hackett%2Fmain..rkt%29._.False%29%29" class="RktValLink" data-pltdoc="x">False</a></span>, which are the only possible values of the
<span class="RktSym"><a href="reference-datatypes.html#%28def._%28%28lib._hackett%2Fmain..rkt%29._~23~25hackett-type~3a.Bool%29%29" class="RktValLink" data-pltdoc="x">Bool</a></span> type. Total functions allow a programmer to reason about programs using the types
alone; a function with the type <span class="RktPn">{</span><span class="RktSym">A</span><span class="stt"> </span><span class="RktSym"><a href="reference-datatypes.html#%28form._%28%28lib._hackett%2Fmain..rkt%29._~23~25hackett-type~3a-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="stt"> </span><span class="RktSym">B</span><span class="RktPn">}</span> implies that is is always possible to get a
<span class="RktSym">B</span> when you have an <span class="RktSym">A</span>.</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p><div class="flexible-container"><span class="margin-note__image-left margin-note__image-left--finger"></span><div class="flexible-element"><a href="reference-controlling-evaluation.html" data-pltdoc="x">Controlling Evaluation</a> in <a href="reference.html" data-pltdoc="x">The Hackett Reference</a> has additional information on partial functions.</div></div></p></blockquote></blockquote></blockquote><p>Sometimes, however, this is impractical. Sometimes the type system is not expressive enough to
constrain the input type as much as the programmer would like. In other cases, the burden of assigning
a precise type to a value might be too high. In these situations, Hackett allows the programmer to
define <a name="(tech._partial._function)"></a><span style="font-style: italic">partial functions</span>. Partial functions should be used extremely judiciously&#8212;when a
partial function is evaluated at runtime, the program will <span style="font-style: italic">crash</span>, producing an error message.</p><p>Hackett provides a built-in partial function named <span class="RktSym"><a href="reference-controlling-evaluation.html#%28def._%28%28lib._hackett%2Fmain..rkt%29._error%21%29%29" class="RktValLink" data-pltdoc="x">error!</a></span> for signaling unrecoverable errors.
This function is not only partial, it is actually undefined for <span style="font-style: italic">all</span> possible values! This
partiality can be observed in <span class="RktSym"><a href="reference-controlling-evaluation.html#%28def._%28%28lib._hackett%2Fmain..rkt%29._error%21%29%29" class="RktValLink" data-pltdoc="x">error!</a></span>&#8217;s type:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktPn">#:type</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="reference-controlling-evaluation.html#%28def._%28%28lib._hackett%2Fmain..rkt%29._error%21%29%29" class="RktValLink" data-pltdoc="x">error!</a></span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">: (forall (a42) (-&gt; String a42))</span></p></td></tr></table></blockquote><p>The <span class="RktSym"><a href="reference-controlling-evaluation.html#%28def._%28%28lib._hackett%2Fmain..rkt%29._error%21%29%29" class="RktValLink" data-pltdoc="x">error!</a></span> function seems impossible, since it promises to produce <span style="font-style: italic">anything</span>, of any
type, when given nothing but a string. Indeed, this type signature lies; it promises it will produce
anything, but this is only possible because it will never actually return anything. When
<span class="RktSym"><a href="reference-controlling-evaluation.html#%28def._%28%28lib._hackett%2Fmain..rkt%29._error%21%29%29" class="RktValLink" data-pltdoc="x">error!</a></span>&#8217;s result is needed, the program will simply crash.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="reference-syntactic-forms.html#%28form._%28%28lib._hackett%2Fmain..rkt%29._~3a%29%29" class="RktStxLink" data-pltdoc="x">:</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference-controlling-evaluation.html#%28def._%28%28lib._hackett%2Fmain..rkt%29._error%21%29%29" class="RktValLink" data-pltdoc="x">error!</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"urk!"</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="reference-datatypes.html#%28def._%28%28lib._hackett%2Fmain..rkt%29._~23~25hackett-type~3a.Unit%29%29" class="RktValLink" data-pltdoc="x">Unit</a></span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktErr">urk!</span></p></td></tr></table></blockquote><p>Partial functions in Hackett are idiomatically indicated by including a <span class="RktInBG"><span class="hspace"></span><span class="RktIn">!</span><span class="hspace"></span></span> symbol at the end
of their names, but this is only a convention; it is not enforced by the compiler or typechecker.</p><p>The <span class="RktSym"><a href="reference-controlling-evaluation.html#%28def._%28%28lib._hackett%2Fmain..rkt%29._error%21%29%29" class="RktValLink" data-pltdoc="x">error!</a></span> function can be considered a way to subvert the type system. Its primary purpose
is to provide a programmer the ability to mark cases which are &#8220;impossible&#8221; based on the logic of the
program, but the typechecker cannot determine that is true. Of course, in practice, things that where
once truly impossible may eventually become possible as code changes, so using some other notion of
failure (such as returning a value wrapped in <span class="RktSym"><a href="reference-datatypes.html#%28def._%28%28lib._hackett%2Fmain..rkt%29._~23~25hackett-type~3a.Maybe%29%29" class="RktValLink" data-pltdoc="x">Maybe</a></span>) is generally preferred whenever
possible.</p><p>In addition to <span class="RktSym"><a href="reference-controlling-evaluation.html#%28def._%28%28lib._hackett%2Fmain..rkt%29._error%21%29%29" class="RktValLink" data-pltdoc="x">error!</a></span>, another partial value provided by Hackett is <span class="RktSym"><a href="reference-controlling-evaluation.html#%28def._%28%28lib._hackett%2Fmain..rkt%29._undefined%21%29%29" class="RktValLink" data-pltdoc="x">undefined!</a></span>. This
is a value, not a function, and it miraculously has any type. The <span class="RktSym"><a href="reference-controlling-evaluation.html#%28def._%28%28lib._hackett%2Fmain..rkt%29._undefined%21%29%29" class="RktValLink" data-pltdoc="x">undefined!</a></span> value will crash
the program as soon as it is evaluated, but it is often useful for getting something to typecheck
before you have finished implementing all of the cases. Generally, <span class="RktSym"><a href="reference-controlling-evaluation.html#%28def._%28%28lib._hackett%2Fmain..rkt%29._undefined%21%29%29" class="RktValLink" data-pltdoc="x">undefined!</a></span> can be useful
as a tool while iteratively writing code, but all uses of <span class="RktSym"><a href="reference-controlling-evaluation.html#%28def._%28%28lib._hackett%2Fmain..rkt%29._undefined%21%29%29" class="RktValLink" data-pltdoc="x">undefined!</a></span> should be replaced by
&#8220;real&#8221; implementations before the code is considered complete.</p><p>Interestingly, while <span class="RktSym"><a href="reference-controlling-evaluation.html#%28def._%28%28lib._hackett%2Fmain..rkt%29._error%21%29%29" class="RktValLink" data-pltdoc="x">error!</a></span> and <span class="RktSym"><a href="reference-controlling-evaluation.html#%28def._%28%28lib._hackett%2Fmain..rkt%29._undefined%21%29%29" class="RktValLink" data-pltdoc="x">undefined!</a></span> crash the program, it is not impossible
to write a functions with the same type signatures, but which do <span style="font-style: italic">not</span> crash the program. How?
Well, it&#8217;s true that a function that promises to return a value of any type the caller asks for can
never return, but there is another possibility besides halting: the function can simply infinitely
loop. Here is an example of such a function, called <span class="RktSym">diverge!</span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="reference-syntactic-forms.html#%28form._%28%28lib._hackett%2Fmain..rkt%29._defn%29%29" class="RktStxLink" data-pltdoc="x">defn</a></span><span class="hspace">&nbsp;</span><span class="RktSym">diverge!</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="reference-syntactic-forms.html#%28form._%28%28lib._hackett%2Fmain..rkt%29._~3a%29%29" class="RktStxLink" data-pltdoc="x">:</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference-datatypes.html#%28form._%28%28lib._hackett%2Fmain..rkt%29._~23~25hackett-type~3aforall%29%29" class="RktStxLink" data-pltdoc="x">forall</a></span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">a</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">{</span><span class="RktSym"><a href="reference-datatypes.html#%28form._%28%28lib._hackett%2Fmain..rkt%29._~23~25hackett-type~3a.String%29%29" class="RktStxLink" data-pltdoc="x">String</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="reference-datatypes.html#%28form._%28%28lib._hackett%2Fmain..rkt%29._~23~25hackett-type~3a-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">}</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">diverge!</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></blockquote><p>This sort of function is often <span style="font-style: italic">also</span> considered partial, since it does not return a value for
all of its inputs.</p><p>It&#8217;s important to keep in mind that Hackett is lazy, and use of partial functions does not change
that! This can result in curious behavior, where a partial function does not cause a program to halt
or diverge, simply because it isn&#8217;t evaluated:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="reference-datatypes.html#%28def._%28%28lib._hackett%2Fmain..rkt%29._const%29%29" class="RktValLink" data-pltdoc="x">const</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="reference-datatypes.html#%28def._%28%28lib._hackett%2Fmain..rkt%29._.Unit%29%29" class="RktValLink" data-pltdoc="x">Unit</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="reference-controlling-evaluation.html#%28def._%28%28lib._hackett%2Fmain..rkt%29._error%21%29%29" class="RktValLink" data-pltdoc="x">error!</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"never gets here"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">: Unit</span></p></td></tr><tr><td><p><span class="RktRes">Unit</span></p></td></tr></table></td></tr></table></blockquote><p>In fact, a partial function can &#8220;lurk&#8221; in an unevaluated thunk for quite a long time, but forcing its
evaluation will cause its effects to become visible. These unpredictable effects are another reason to
use partial functions extremely sparingly.</p><p>Partial values that, once evaluated, will trigger partial behavior are known as <a name="(tech._bottom)"></a><span style="font-style: italic">bottoms</span>.
Documentation of certain forms and functions may note that something is true &#8220;ignoring bottom&#8221;. This
is because many guarantees can technically be broken when partial functions are involved, but it is
often more useful to temporarily pretend they do not exist in order to reason about some code using
types alone. This is a powerful property of Hackett&#8217;s type system; do not squander that power with
reckless use of partiality.</p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="guide-working-with-data.html" title="backward to &quot;1.3 Working with data&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="guide.html" title="up to &quot;1 The Hackett Guide&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="reference.html" title="forward to &quot;2 The Hackett Reference&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>